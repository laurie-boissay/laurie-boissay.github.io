---
title: "Recettes low carb"
description: "Mes recettes low carb (recettes faibles en glucides). Index par catégories."
---

<!DOCTYPE html>
<html lang="fr">
<head>
  {% include head.html %}
</head>

<body class="container-fluid">

  <header id="objectifs" class="marge">
    <h1><strong>Mes recettes low carb</strong></h1>
    <h3><span class="bleu">ou recettes faibles en glucides</span></h3>
    <h2><span class="orange">Travail en cours !</span></h2>
  </header>

  {% include navbar.html %}

  <section class="marge" id="index">
    <h2>Index</h2>

    <!-- Suggestion aléatoire (hors goût sucré + hors bases) -->
    <div class="container mb-4">
      <div id="random-pick"></div>
    </div>

    {% assign all_recipes = site.pages | where: "layout", "recipe" | where_exp: "p", "p.recipe_group" %}
    {% assign groups = all_recipes | map: "recipe_group" | sort | uniq %}

    <!-- Boutons catégories (auto) -->
    <div class="container text-center mb-4">
      {% for g in groups %}
        <a class="btn btn-outline-primary m-1" href="index.html#{{ g | slugify }}">{{ g }}</a>
      {% endfor %}
    </div>

    <!-- Sections catégories (auto) -->
    <div class="container" id="recipes-index">
      {% for g in groups %}
        <h3 id="{{ g | slugify }}">{{ g }}</h3>

        <div
          class="recipe-group-block mb-4"
          data-recipe-group="{{ g | escape }}"
        >
          {% assign group_recipes = all_recipes | where: "recipe_group", g | sort: "recipe_sort" %}

          {% for r in group_recipes %}
            <article
              class="recipe-card mb-2"
              data-tags="{{ r.tags | join: ',' | escape }}"
            >
              <a href="{{ r.url | relative_url }}">
                {{ r.recipe_title }}
              </a>
              {% if r.recipe_subtitle %}
                <div class="text-muted small">{{ r.recipe_subtitle }}</div>
              {% endif %}
            </article>
          {% endfor %}
        </div>

      {% endfor %}
    </div>
  </section>

  <footer class="marge">
    <div class="container text-center">
      <div class="row align-items-top">
        <div class="col">
          Dernière mise à jour le {{ site.time | date: "%d/%m/%Y" }}
        </div>
      </div>
    </div>
  </footer>

  {% include scripts.html %}

  <script>
    /*
      EXCLUSIONS FERMES POUR LE TIRAGE :
      - tag "gout-sucre"
      - recipe_group "Bases" ou "Bases pour goût sucré" (tout ce qui commence par "Bases")
    */

    const EXCLUDED_TAG = "gout-sucre";
    const EXCLUDED_GROUP_PREFIX = "bases";

    const indexRoot = document.getElementById("recipes-index");
    const pickHost = document.getElementById("random-pick");

    let lastHref = null;

    function isValidRecipeLink(a) {
      const href = (a.getAttribute("href") || "").trim();
      if (!href) return false;
      if (href.startsWith("#")) return false;
      if (href.startsWith("http://") || href.startsWith("https://") || href.startsWith("mailto:")) return false;
      if (!href.endsWith(".html")) return false;
      if (href === "index.html" || href.endsWith("/index.html")) return false;

      const title = (a.textContent || "").trim();
      if (!title) return false;

      return true;
    }

    function hasExcludedTag(card) {
      const tags = (card.dataset.tags || "")
        .split(",")
        .map(t => t.trim().toLowerCase())
        .filter(Boolean);

      return tags.includes(EXCLUDED_TAG);
    }

    function isInExcludedGroup(a) {
      // Remonte jusqu’au conteneur qui porte data-recipe-group
      const groupEl = a.closest("[data-recipe-group]");
      if (!groupEl) return false;

      const group = (groupEl.dataset.recipeGroup || "").trim().toLowerCase();
      return group.startsWith(EXCLUDED_GROUP_PREFIX);
    }

    function getCandidates() {
      if (!indexRoot) return [];

      return Array.from(indexRoot.querySelectorAll(".recipe-card a[href]"))
        .filter(isValidRecipeLink)
        .filter(a => {
          const card = a.closest(".recipe-card");
          if (!card) return false;

          if (hasExcludedTag(card)) return false;
          if (isInExcludedGroup(a)) return false;

          return true;
        });
    }

    function pickRandom(links) {
      if (links.length === 0) return null;
      if (links.length === 1) return links[0];

      let a;
      let tries = 0;
      do {
        a = links[Math.floor(Math.random() * links.length)];
        tries++;
      } while (a.getAttribute("href") === lastHref && tries < 30);

      lastHref = a.getAttribute("href");
      return a;
    }

    function renderPick(a) {
      const href = a.getAttribute("href");
      const title = (a.textContent || "").trim();

      pickHost.innerHTML = `
        <div class="card">
          <div class="card-body text-center">
            <div class="mb-3 fw-bold fs-4">On mange quoi&nbsp;?</div>
            <h3 class="h5 mb-3">${title}</h3>

            <div class="d-flex justify-content-center flex-wrap gap-2">
              <a class="btn btn-primary" href="${href}">Ça me plaît</a>
              <button id="btn-reroll" type="button" class="btn btn-outline-secondary">
                Autre idée
              </button>
            </div>
          </div>
        </div>
      `;

      document.getElementById("btn-reroll").addEventListener("click", pickAndRender);
    }

    function renderEmpty() {
      pickHost.innerHTML = `
        <div class="alert alert-warning mb-0">
          Aucune recette disponible (hors bases et hors goût sucré).
        </div>
      `;
    }

    function pickAndRender() {
      const links = getCandidates();
      if (links.length === 0) return renderEmpty();

      const a = pickRandom(links);
      if (!a) return renderEmpty();

      renderPick(a);
    }

    // Tirage au chargement
    pickAndRender();
  </script>

</body>
</html>
