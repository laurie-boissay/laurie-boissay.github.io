---
layout: page
title: "Recettes low carb"
description: "Mes recettes low carb (recettes faibles en glucides). Index par catÃ©gories."
page_h1: "Mes recettes low carb"
page_h3: "ou recettes faibles en glucides"
page_h2_orange: "Travail en cours !"
body_id: "home"
---

<section id="index">
  <h2>Index</h2>

  <!-- Styles locaux (index) -->
  <style>
    /* 2 lignes : badges tags puis micronutriments */
    .recipe-badges-line{
      display:flex;
      flex-wrap:nowrap;            /* une seule ligne */
      gap:.35rem;
      list-style:none;
      padding:0;
      margin:.25rem 0 0 0;
      overflow-x:auto;             /* si trop long, scroll horizontal */
      -webkit-overflow-scrolling: touch;
    }
    .recipe-badges-line li{
      display:flex;
      align-items:center;
      font-size:1.15rem;
      line-height:1;
      white-space:nowrap;
    }
    .recipe-badges-wrap{
      margin-top:.35rem;
    }
    /* Placeholder micronutriments (temporaire) */
    .badge-placeholder{
      opacity:.55;
      font-size:.95rem;
    }
  </style>

  <!-- Suggestion alÃ©atoire -->
  <div class="mb-4">
    <div id="random-pick"></div>
  </div>

  {% assign all_recipes = site.pages | where: "layout", "recipe" | where_exp: "p", "p.recipe_group" %}
  {% assign grouped = all_recipes | group_by: "recipe_group" | sort: "name" %}

  {%- assign hidden_tags = "low-carb-modere,low-carb-strict,gout-sucre" | split: "," -%}

  {%- assign tag_badges = {
    "tres-proteine": "ğŸ’ª",
    "riche-en-fibres": "ğŸ’©",
    "rapide": "â±ï¸",
    "congelable": "â„ï¸",
    "micro-ondable": "â™¨ï¸",
    "peu-calorique": "ğŸª¶",
    "calorique": "ğŸ”¥",
    "longue": "ğŸŒ"
  } -%}

  {%- assign micro_badges = {
    "omega-3": "ğŸŸ",

    "vitamine-a": "ğŸ‘ï¸",
    "vitamine-c": "ğŸ‹",
    "vitamine-d": "ğŸŒ¤ï¸",
    "vitamine-e": "ğŸ›¡ï¸",
    "vitamine-k": "ğŸ©¸",
    "vitamine-b9": "ğŸŒ±",
    "vitamine-b12": "ğŸ¥©",

    "calcium": "ğŸ¦´",
    "fer": "ğŸ§²",
    "magnesium": "âš¡",
    "potassium": "ğŸŒ",
    "zinc": "ğŸ”©",
    "selenium": "ğŸ§ª",
    "iode": "ğŸŒŠ"
  } -%}

  <!-- Sections catÃ©gories -->
  <div id="recipes-index">
    {% for g in grouped %}
      <h3 id="{{ g.name | slugify }}">{{ g.name }}</h3>

      <div class="recipe-group-block mb-4" data-recipe-group="{{ g.name | escape }}">
        {% assign group_recipes = g.items | sort: "recipe_sort" %}

        <div class="recipes-grid">
          {% for r in group_recipes %}
            <article class="recipe-card mb-2" data-tags="{{ r.tags | join: ',' | escape }}">
              <a
                class="recipe-card-link"
                href="{{ r.url | relative_url }}"
                data-tested="{{ r.recipe_tested }}"
                data-title="{{ r.recipe_title | escape }}"
              >
                <div class="recipe-card-top">
                  <h4 class="recipe-card-title">{{ r.recipe_title }}</h4>

                  {% if r.recipe_tested == false %}
                    <span class="badge bg-warning text-dark ms-2">Recette non testÃ©e</span>
                  {% endif %}
                </div>

                <!-- Sous-titre temporairement masquÃ© : on n'affiche plus recipe_subtitle -->

                <div class="recipe-badges-wrap">
                  <!-- Ligne 1 : badges (tags) -->
                  {% if r.tags %}
                    <ul class="recipe-badges-line badges-tags" aria-label="Badges">
                      {% for tag in r.tags %}
                        {% unless hidden_tags contains tag %}
                          {% if tag_badges[tag] %}
                            <li title="{{ tag }}">{{ tag_badges[tag] }}</li>
                          {% endif %}
                        {% endunless %}
                      {% endfor %}
                    </ul>
                  {% endif %}

                  <!-- Ligne 2 : micronutriments (placeholder si vide) -->
                  {% assign micros = r.badges_nutritionnels | default: "" %}
                  <ul class="recipe-badges-line badges-micro" aria-label="Micronutriments">
                    {% if micros and micros.size > 0 %}
                      {% for m in micros %}
                        {% if micro_badges[m] %}
                          <li title="{{ m }}">{{ micro_badges[m] }}</li>
                        {% endif %}
                      {% endfor %}
                    {% else %}
                      <li class="badge-placeholder" title="Micronutriments : Ã  complÃ©ter">â€”</li>
                    {% endif %}
                  </ul>
                </div>

              </a>
            </article>
          {% endfor %}
        </div>

      </div>
    {% endfor %}
  </div>

  <hr class="my-4">

  <div class="text-center muted">
    DerniÃ¨re mise Ã  jour le {{ site.time | date: "%d/%m/%Y" }}
  </div>
</section>

<script>
  const EXCLUDED_TAG = "gout-sucre";

  // Exclusions du tirage alÃ©atoire par recipe_group (comparaison en minuscules)
  const EXCLUDED_GROUPS = [
    "amuse-bouche",
    "boissons",
    "pains & substituts",
    "pÃ¢tes & fonds",
    "sauces & assaisonnements",
    "lÃ©gumes & accompagnements",
    "prÃ©parations & conservations",
    "barres nutritionnelles"
  ];

  const indexRoot = document.getElementById("recipes-index");
  const pickHost = document.getElementById("random-pick");

  let lastHref = null;

  function isValidRecipeLink(a) {
    const href = (a.getAttribute("href") || "").trim();
    if (!href) return false;
    if (href.startsWith("#")) return false;
    if (!href.endsWith(".html")) return false;

    const title = (a.dataset.title || a.textContent || "").trim();
    if (!title) return false;

    return true;
  }

  function hasExcludedTag(card) {
    const tags = (card.dataset.tags || "")
      .split(",")
      .map(t => t.trim().toLowerCase())
      .filter(Boolean);

    return tags.includes(EXCLUDED_TAG);
  }

  function isInExcludedGroup(a) {
    const groupEl = a.closest("[data-recipe-group]");
    if (!groupEl) return false;

    const group = (groupEl.dataset.recipeGroup || "").toLowerCase().trim();
    return EXCLUDED_GROUPS.includes(group);
  }

  function getCandidates() {
    if (!indexRoot) return [];

    return Array.from(indexRoot.querySelectorAll(".recipe-card a[href]"))
      .filter(isValidRecipeLink)
      .filter(a => {
        const card = a.closest(".recipe-card");
        if (!card) return false;

        if (hasExcludedTag(card)) return false;
        if (isInExcludedGroup(a)) return false;

        return true;
      });
  }

  function pickRandom(links) {
    if (links.length === 0) return null;

    let a;
    let tries = 0;
    do {
      a = links[Math.floor(Math.random() * links.length)];
      tries++;
    } while (a.getAttribute("href") === lastHref && tries < 20);

    lastHref = a.getAttribute("href");
    return a;
  }

  function renderPick(a) {
    const href = a.getAttribute("href");
    const title = (a.dataset.title || a.textContent || "").trim();
    const tested = a.dataset.tested === "true";

    pickHost.innerHTML = `
      <div class="pick-card">
        <div class="pick-card-body text-center">
          <div class="mb-2 fw-bold fs-4">On mange quoi&nbsp;?</div>

          <h3 class="h5 mb-3">
            ${title}
            ${tested ? "" : `
              <span class="badge bg-warning text-dark ms-2">
                Recette non testÃ©e
              </span>
            `}
          </h3>

          <div class="d-flex justify-content-center gap-2 mt-3">
            <a class="btn btn-primary" href="${href}">Ã‡a me plaÃ®t</a>
            <button id="btn-reroll" type="button" class="btn btn-outline-secondary">
              Autre idÃ©e
            </button>
          </div>
        </div>
      </div>
    `;

    document
      .getElementById("btn-reroll")
      .addEventListener("click", pickAndRender);
  }

  function renderEmpty() {
    pickHost.innerHTML = `
      <div class="alert alert-warning mb-0">
        Aucune recette disponible.
      </div>
    `;
  }

  function pickAndRender() {
    const links = getCandidates();
    if (links.length === 0) return renderEmpty();

    const a = pickRandom(links);
    if (!a) return renderEmpty();

    renderPick(a);
  }

  pickAndRender();
</script>
