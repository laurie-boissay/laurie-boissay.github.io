{%- comment -%}
==============================================================================
_includes/recipes-index.html â€” Rendu centralisÃ© des cartes recette
==============================================================================

RÃ´le
- Produire le markup unique des cartes recette pour toutes les pages dâ€™index
  (ex : index.html, tag-index.html), afin dâ€™Ã©viter toute divergence dâ€™affichage.

EntrÃ©es (paramÃ¨tres dâ€™include)
- include.grouped (requis)
  â€¢ Tableau issu de `group_by: "recipe_group"`.
  â€¢ Chaque entrÃ©e contient : name (nom du groupe) + items (pages recettes).
- include.hidden_tags (optionnel)
  â€¢ Array de tags â€œtechniquesâ€ Ã  masquer dans lâ€™affichage des badges.

Sortie (markup / data-* exposÃ©s)
- .recipe-item[data-tested="true|false"]
  â€¢ Contrat requis par filter-tested.html (filtre â€œSeulement les recettes testÃ©esâ€).
- a.recipe-card-link[data-title][data-subtitle][data-tested]
  â€¢ Contrat exploitÃ© par random-pick et/ou scripts de navigation.
- article.recipe-card[data-tags][data-micros]
  â€¢ MÃ©tadonnÃ©es disponibles pour des filtres / recherches cÃ´tÃ© client.

Contraintes
- StabilitÃ© :
  â€¢ Tri des groupes par g.name (affichage dÃ©terministe).
  â€¢ Tri des recettes par recipe_sort (ordre stable intra-groupe).
- TolÃ©rance aux donnÃ©es manquantes :
  â€¢ group name vide => groupe ignorÃ© (Ã©vite ancres / sections invalides).
  â€¢ recipe_subtitle / badges_nutritionnels optionnels.
- AccessibilitÃ© :
  â€¢ HiÃ©rarchie : H3 = titre de groupe, H4 = titre de carte.
  â€¢ aria-label sur les listes de badges.

Remarques
- Le mapping tag/micronutriment â†’ emoji + title est centralisÃ© ici pour garantir
  une cohÃ©rence UI entre toutes les pages.
==============================================================================
{%- endcomment -%}

{%- comment -%}
  hidden_tags est optionnel : on sÃ©curise pour Ã©viter une erreur Liquid si lâ€™appelant
  nâ€™en fournit pas.
{%- endcomment -%}
{%- assign hidden_tags = include.hidden_tags | default: "" -%}

{%- comment -%}
  Tri des groupes par nom :
  - Garantit un rendu stable quel que soit lâ€™ordre de construction en amont.
{%- endcomment -%}
{%- assign grouped_sorted = include.grouped | sort: "name" -%}

<div id="recipes-index">
  {%- comment -%}
    Parcours des groupes (recipe_group).
    Les groupes sans nom sont ignorÃ©s pour Ã©viter :
    - des titres vides
    - des ancres (#) inutiles / non dÃ©terministes.
  {%- endcomment -%}
  {%- for g in grouped_sorted -%}
    {%- if g.name and g.name != "" -%}

      <h3 id="{{ g.name | slugify }}" class="recipe-category-title">
        <a href="#{{ g.name | slugify }}">{{ g.name }}</a>
      </h3>

      <div class="recipe-group-block mb-4" data-recipe-group="{{ g.name | escape }}">
        {%- comment -%}
          Tri intra-groupe :
          - recipe_sort est la clÃ© fonctionnelle courte dÃ©finie par convention Ã©ditoriale.
          - Ce tri Ã©vite lâ€™instabilitÃ© liÃ©e au titre (accents / variations).
        {%- endcomment -%}
        {%- assign group_recipes = g.items | sort: "recipe_sort" -%}

        <div class="recipes-grid">
          {%- comment -%}
            Rendu dâ€™une carte par recette.
            Le wrapper .recipe-item est le point dâ€™ancrage du filtre "recettes testÃ©es".
          {%- endcomment -%}
          {%- for r in group_recipes -%}

            <div
              class="recipe-item"
              data-tested="{% if r.recipe_tested == true %}true{% else %}false{% endif %}"
            >
              <article
                class="recipe-card mb-2"
                data-tags="{{ r.tags | join: ',' | escape }}"
                data-micros="{{ r.badges_nutritionnels | join: ',' | escape }}"
              >
                <a
                  class="recipe-card-link"
                  href="{{ r.url | relative_url }}"
                  data-tested="{% if r.recipe_tested == true %}true{% else %}false{% endif %}"
                  data-title="{{ r.recipe_title | escape }}"
                  data-subtitle="{{ r.recipe_subtitle | default: '' | strip_html | escape }}"
                >
                  <div class="recipe-card-top">
                    <h4 class="recipe-card-title">{{ r.recipe_title }}</h4>
                  </div>

                  {%- if r.recipe_subtitle -%}
                    <p class="recipe-card-subtitle mb-1">{{ r.recipe_subtitle }}</p>
                  {%- endif -%}

                  {%- comment -%}
                    Indicateur â€œnon testÃ©eâ€ :
                    - volontairement redondant avec le bandeau du layout recette,
                      car il sâ€™agit ici dâ€™un repÃ¨re de navigation sur les index.
                  {%- endcomment -%}
                  {%- if r.recipe_tested == false -%}
                    <span class="badge bg-warning text-dark mb-2">Recette non testÃ©e</span>
                  {%- endif -%}

                  <div class="recipe-badges-wrap">
                    {%- comment -%}
                      Ligne 1 â€” badges tags :
                      - Exclut les tags techniques listÃ©s dans hidden_tags.
                      - Nâ€™affiche que les tags reconnus (mapping contrÃ´lÃ©).
                    {%- endcomment -%}
                    {%- if r.tags -%}
                      <ul class="recipe-badges-line badges-tags" aria-label="Badges">
                        {%- for tag in r.tags -%}
                          {%- unless hidden_tags contains tag -%}
                            {%- case tag -%}
                              {%- when "tres-proteine" -%}<li title="TrÃ¨s protÃ©inÃ©">ğŸ’ª</li>
                              {%- when "riche-en-fibres" -%}<li title="Riche en fibres">ğŸ’©</li>
                              {%- when "rapide" -%}<li title="Rapide">â±ï¸</li>
                              {%- when "congelable" -%}<li title="CongÃ©lable">â„ï¸</li>
                              {%- when "micro-ondable" -%}<li title="Micro-ondable">â™¨ï¸</li>
                              {%- when "peu-calorique" -%}<li title="Peu calorique">ğŸª¶</li>
                              {%- when "calorique" -%}<li title="Calorique">ğŸ”¥</li>
                              {%- when "longue" -%}<li title="PrÃ©paration longue">ğŸŒ</li>
                            {%- endcase -%}
                          {%- endunless -%}
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}

                    {%- comment -%}
                      Ligne 2 â€” badges micronutriments :
                      - Source : r.badges_nutritionnels (liste dâ€™IDs).
                      - AffichÃ©e uniquement si la liste est non vide.
                    {%- endcomment -%}
                    {%- assign micros = r.badges_nutritionnels | default: "" -%}
                    {%- if micros and micros.size > 0 -%}
                      <ul class="recipe-badges-line badges-micro" aria-label="Micronutriments">
                        {%- for m in micros -%}
                          {%- case m -%}
                            {%- when "omega-3" -%}<li title="OmÃ©ga-3">ğŸŸ</li>
                            {%- when "vitamine-a" -%}<li title="Vitamine A">ğŸ‘ï¸</li>
                            {%- when "vitamine-c" -%}<li title="Vitamine C">ğŸ‹</li>
                            {%- when "vitamine-d" -%}<li title="Vitamine D">ğŸŒ¤ï¸</li>
                            {%- when "vitamine-e" -%}<li title="Vitamine E">ğŸ›¡ï¸</li>
                            {%- when "vitamine-k" -%}<li title="Vitamine K">ğŸ©¸</li>
                            {%- when "vitamine-b9" -%}<li title="Vitamine B9">ğŸŒ±</li>
                            {%- when "vitamine-b12" -%}<li title="Vitamine B12">ğŸ¥©</li>
                            {%- when "calcium" -%}<li title="Calcium">ğŸ¦´</li>
                            {%- when "fer" -%}<li title="Fer">ğŸ§²</li>
                            {%- when "magnesium" -%}<li title="MagnÃ©sium">âš¡</li>
                            {%- when "potassium" -%}<li title="Potassium">ğŸŒ</li>
                            {%- when "zinc" -%}<li title="Zinc">ğŸ”©</li>
                            {%- when "selenium" -%}<li title="SÃ©lÃ©nium">ğŸ§ª</li>
                            {%- when "iode" %}<li title="Iode">ğŸŒŠ</li>
                          {%- endcase -%}
                        {%- endfor -%}
                      </ul>
                    {%- endif -%}
                  </div>

                </a>
              </article>

            </div>
          {%- endfor -%}
        </div>
      </div>

    {%- endif -%}
  {%- endfor -%}
</div>

