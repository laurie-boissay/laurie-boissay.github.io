<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous">
</script>

<script>
  // Mobile : fermer le burger + le panneau "Recettes" après clic sur une catégorie
  document.addEventListener("click", function (e) {
    const chip = e.target.closest(".recipes-group-chip");
    if (!chip) return;

    // Ferme le panneau catégories (collapse interne)
    const groupsEl = document.getElementById("recipesGroupsCollapse");
    if (groupsEl && window.bootstrap) {
      const groupsInstance =
        window.bootstrap.Collapse.getInstance(groupsEl) ||
        new window.bootstrap.Collapse(groupsEl, { toggle: false });
      groupsInstance.hide();
    }

    // Ferme le menu mobile (burger)
    const navEl = document.getElementById("navbarSupportedContent");
    if (navEl && window.bootstrap) {
      const navInstance =
        window.bootstrap.Collapse.getInstance(navEl) ||
        new window.bootstrap.Collapse(navEl, { toggle: false });
      navInstance.hide();
    }
  });

  // Corriger l'offset sticky navbar quand on arrive sur une ancre (/#groupe)
  // ou quand le hash change : évite que le titre de catégorie soit caché.
  function fixAnchorOffset() {
    if (!location.hash) return;

    // Ne pas planter si le hash contient des caractères spéciaux non existants
    let target;
    try {
      target = document.querySelector(location.hash);
    } catch (err) {
      return;
    }
    if (!target) return;

    const nav = document.getElementById("navigation");
    if (!nav) return;

    const navH = nav.getBoundingClientRect().height;
    const y = target.getBoundingClientRect().top + window.scrollY - navH - 12;

    // "instant" n'est pas standard partout ; fallback sur auto
    try {
      window.scrollTo({ top: y, behavior: "instant" });
    } catch (e) {
      window.scrollTo({ top: y, behavior: "auto" });
    }
  }

  // Au chargement : on laisse le layout se stabiliser (bootstrap + fonts)
  window.addEventListener("load", () => {
    setTimeout(fixAnchorOffset, 0);
    setTimeout(fixAnchorOffset, 150);
  });

  // Quand le hash change sans rechargement
  window.addEventListener("hashchange", () => {
    setTimeout(fixAnchorOffset, 0);
  });
</script>
