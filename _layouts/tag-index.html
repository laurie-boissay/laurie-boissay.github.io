---
layout: page
---

{%- comment -%}
==============================================================================
tag-index.html â€” Page dâ€™index filtrÃ©e (tags fonctionnels / micronutriments)
==============================================================================

RÃ´le
- Afficher une liste de recettes filtrÃ©e par :
  â€¢ tag fonctionnel (page.filter_type = "tag")
  â€¢ micronutriment (page.filter_type = "micro")

EntrÃ©es (front-matter)
- filter_type : "tag" | "micro"
- filter_id   : identifiant du tag (ex: "rapide") ou du micronutriment (ex: "omega-3")

Contrats / dÃ©pendances
- random-pick.html :
  â€¢ doit Ãªtre rendu AVANT la navigation par badges (contrainte UX).
  â€¢ lit document.body.dataset.filterType / filterId : ces attributs doivent Ãªtre posÃ©s
    immÃ©diatement (pas de dÃ©pendance Ã  DOMContentLoaded).
- DonnÃ©es :
  â€¢ _data/tags_fonctionnels.yml : descriptions des tags fonctionnels.
  â€¢ _data/micronutriments.yml   : fiches micronutriments (rÃ´les, apports, sources, etc.).

Contraintes dâ€™affichage
- Le filtre â€œrecettes testÃ©esâ€ nâ€™est affichÃ© que sâ€™il existe au moins une recette
  non testÃ©e dans la sÃ©lection (Ã©vite un contrÃ´le inutile).

Note importante (gout-sucre)
- Le tag "gout-sucre" DOIT Ãªtre affichÃ© sur les cartes (emoji ğŸ¬).
- Son exclusion du tirage alÃ©atoire se gÃ¨re dans la logique du random pick (JS),
  pas via hidden_tags (qui ne fait que masquer lâ€™affichage).
==============================================================================
{%- endcomment -%}

<section class="site-container" id="tag-index">

  {%- comment -%}
    ParamÃ¨tres de filtre exposÃ©s au JS (random pick).
    Le script consomme dataset.* dÃ¨s le chargement : pas de temporisation.
  {%- endcomment -%}
  <script>
    document.body.dataset.filterType = "{{ page.filter_type | escape }}";
    document.body.dataset.filterId   = "{{ page.filter_id   | escape }}";
  </script>

  {%- comment -%}
    Random pick :
    - placÃ© avant la navigation (contrainte UX).
    - hide_links Ã©vite la redondance avec la navigation par badges de cette page.
  {%- endcomment -%}
  {% include random-pick.html hide_links=true %}

  {%- comment -%}
    Raccourcis de navigation (tags + micronutriments) :
    - prÃ©sentÃ© comme un bloc â€œfiltres rapidesâ€ (UX explicite).
    - source unique : nav-badges.html.
  {%- endcomment -%}
  <div class="nav-shortcuts" aria-label="Raccourcis de filtres">
    <div class="nav-shortcuts-title">Raccourcis</div>
    <p class="nav-shortcuts-hint">Changer rapidement de filtre (tags fonctionnels et micronutriments).</p>
    {% include nav-badges.html %}
  </div>

  {%- comment -%}
    Tags techniques masquÃ©s dans lâ€™UI des cartes :
    - low-carb-modere / low-carb-strict : tags de classification, non affichÃ©s en badges.
  {%- endcomment -%}
  {%- assign hidden_tags = "low-carb-modere,low-carb-strict" | split: "," -%}

  {%- assign recipes = site.pages | where: "layout", "recipe" -%}
  {%- assign filtered = "" | split: "" -%}

  {%- comment -%}
    Filtrage :
    - mode "tag"  : r.tags contient page.filter_id
    - mode "micro": r.badges_nutritionnels contient page.filter_id
  {%- endcomment -%}
  {%- for r in recipes -%}
    {%- if page.filter_type == "tag" and page.filter_id and r.tags contains page.filter_id -%}
      {%- assign filtered = filtered | push: r -%}
    {%- elsif page.filter_type == "micro" and page.filter_id and r.badges_nutritionnels contains page.filter_id -%}
      {%- assign filtered = filtered | push: r -%}
    {%- endif -%}
  {%- endfor -%}

  {%- assign tested_count = 0 -%}
  {%- for r in filtered -%}
    {%- if r.recipe_tested == true -%}
      {%- assign tested_count = tested_count | plus: 1 -%}
    {%- endif -%}
  {%- endfor -%}

  <p class="small text-muted mb-2">
    <strong>{{ filtered.size }}</strong> recette(s).
    <span class="ms-2">TestÃ©e(s) : <strong>{{ tested_count }}</strong>.</span>
  </p>

  {%- comment -%}
    Filtre â€œrecettes testÃ©esâ€ :
    - affichÃ© uniquement si la sÃ©lection contient au moins une recette non testÃ©e.
    - le comportement JS sâ€™appuie sur data-tested sur .recipe-item.
  {%- endcomment -%}
  {%- if filtered.size > tested_count -%}
    {% include filter-tested.html %}
  {%- endif -%}

  {%- comment -%}
    Bloc descriptif :
    - tag : contenu issu de _data/tags_fonctionnels
    - micro : contenu issu de _data/micronutriments
    Le bloc nâ€™est rendu que si lâ€™entrÃ©e correspondante existe (fail-safe).
  {%- endcomment -%}
  {%- if page.filter_type == "tag" and page.filter_id -%}
    {%- assign taginfo = site.data.tags_fonctionnels[page.filter_id] -%}
    {%- if taginfo -%}
      <section class="micro-desc">
        <h2>{{ taginfo.titre }}</h2>
        <p>{{ taginfo.signification }}</p>

        {%- if taginfo.criteres -%}
          <h3>CritÃ¨res dâ€™attribution</h3>
          <ul>
            {%- for c in taginfo.criteres -%}<li>{{ c }}</li>{%- endfor -%}
          </ul>
        {%- endif -%}
      </section>
    {%- endif -%}
  {%- endif -%}

  {%- if page.filter_type == "micro" and page.filter_id -%}
    {%- assign micro = site.data.micronutriments[page.filter_id] -%}
    {%- if micro -%}
      <section class="micro-desc">
        <h2>{{ micro.titre }}</h2>
        <p>{{ micro.resume }}</p>

        <h3>Ã€ quoi Ã§a sert ?</h3>
        <ul>{% for r in micro.roles %}<li>{{ r }}</li>{% endfor %}</ul>

        <h3>Apports recommandÃ©s</h3>
        <p><strong>Adulte :</strong> {{ micro.apports.adulte.cible }}</p>

        <h3>Sources alimentaires</h3>
        <ul>{% for f in micro.ou_en_trouver %}<li>{{ f }}</li>{% endfor %}</ul>

        <h3>Signes de carence</h3>
        <p>{{ micro.carence.signes }}</p>
      </section>
    {%- endif -%}
  {%- endif -%}

  {%- comment -%}
    Regroupement :
    - group_by sur recipe_group
    - exclusion des groupes vides (Ã©vite des sections sans titre)
  {%- endcomment -%}
  {%- assign grouped_raw = filtered | group_by: "recipe_group" -%}
  {%- assign grouped = "" | split: "" -%}

  {%- for g in grouped_raw -%}
    {%- if g.name and g.name != "" -%}
      {%- assign grouped = grouped | push: g -%}
    {%- endif -%}
  {%- endfor -%}

  <div id="recipes-index">
    {% for g in grouped %}
      <h3 id="{{ g.name | slugify }}" class="recipe-category-title">
        <a href="#{{ g.name | slugify }}">{{ g.name }}</a>
      </h3>

      <div class="recipe-group-block mb-4" data-recipe-group="{{ g.name | escape }}">
        {% assign group_recipes = g.items | sort: "recipe_sort" %}

        <div class="recipes-grid">
          {% for r in group_recipes %}

            <div
              class="recipe-item"
              data-tested="{% if r.recipe_tested == true %}true{% else %}false{% endif %}"
            >
              <article
                class="recipe-card mb-2"
                data-tags="{{ r.tags | join: ',' | escape }}"
                data-micros="{{ r.badges_nutritionnels | join: ',' | escape }}"
              >
                <div class="recipe-card-top">
                  <h4 class="recipe-card-title">
                    <a class="recipe-title-link" href="{{ r.url | relative_url }}">
                      {{ r.recipe_title }}
                    </a>
                  </h4>
                </div>

                {% if r.recipe_subtitle %}
                  <p class="recipe-card-subtitle mb-1">{{ r.recipe_subtitle }}</p>
                {% endif %}

                {% if r.recipe_tested == false %}
                  <span class="badge bg-warning text-dark mb-2">Recette non testÃ©e</span>
                {% endif %}

                <div class="recipe-card-actions">
                  <a class="btn btn-sm btn-primary" href="{{ r.url | relative_url }}">Voir la recette</a>
                </div>

                <div class="recipe-badges-wrap">
                  {% if r.tags %}
                    <ul class="recipe-badges-line badges-tags" aria-label="Tags fonctionnels">
                      {% for tag in r.tags %}
                        {% unless hidden_tags contains tag %}
                          {% case tag %}
                            {% when "tres-proteine" %}
                              <li><a class="badge-link-card" href="{{ '/tags/tres-proteine/' | relative_url }}" title="TrÃ¨s protÃ©inÃ©">ğŸ’ª</a></li>
                            {% when "riche-en-fibres" %}
                              <li><a class="badge-link-card" href="{{ '/tags/riche-en-fibres/' | relative_url }}" title="Riche en fibres">ğŸ’©</a></li>
                            {% when "rapide" %}
                              <li><a class="badge-link-card" href="{{ '/tags/rapide/' | relative_url }}" title="Rapide">â±ï¸</a></li>
                            {% when "congelable" %}
                              <li><a class="badge-link-card" href="{{ '/tags/congelable/' | relative_url }}" title="CongÃ©lable">â„ï¸</a></li>
                            {% when "micro-ondable" %}
                              <li><a class="badge-link-card" href="{{ '/tags/micro-ondable/' | relative_url }}" title="Micro-ondable">â™¨ï¸</a></li>
                            {% when "peu-calorique" %}
                              <li><a class="badge-link-card" href="{{ '/tags/peu-calorique/' | relative_url }}" title="Peu calorique">ğŸª¶</a></li>
                            {% when "calorique" %}
                              <li><a class="badge-link-card" href="{{ '/tags/calorique/' | relative_url }}" title="Calorique">ğŸ”¥</a></li>
                            {% when "longue" %}
                              <li><a class="badge-link-card" href="{{ '/tags/longue/' | relative_url }}" title="PrÃ©paration longue">ğŸŒ</a></li>
                            {% when "gout-sucre" %}
                              <li><a class="badge-link-card" href="{{ '/tags/gout-sucre/' | relative_url }}" title="GoÃ»t sucrÃ©">ğŸ¬</a></li>
                          {% endcase %}
                        {% endunless %}
                      {% endfor %}
                    </ul>
                  {% endif %}

                  {% assign micros = r.badges_nutritionnels | default: "" %}
                  {% if micros and micros.size > 0 %}
                    <ul class="recipe-badges-line badges-micro" aria-label="Micronutriments">
                      {% for m in micros %}
                        {% case m %}
                          {% when "omega-3" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/omega-3/' | relative_url }}" title="OmÃ©ga-3">ğŸŸ</a></li>
                          {% when "vitamine-a" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-a/' | relative_url }}" title="Vitamine A">ğŸ‘ï¸</a></li>
                          {% when "vitamine-c" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-c/' | relative_url }}" title="Vitamine C">ğŸ‹</a></li>
                          {% when "vitamine-d" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-d/' | relative_url }}" title="Vitamine D">ğŸŒ¤ï¸</a></li>
                          {% when "vitamine-e" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-e/' | relative_url }}" title="Vitamine E">ğŸ›¡ï¸</a></li>
                          {% when "vitamine-k" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-k/' | relative_url }}" title="Vitamine K">ğŸ©¸</a></li>
                          {% when "vitamine-b9" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-b9/' | relative_url }}" title="Vitamine B9">ğŸŒ±</a></li>
                          {% when "vitamine-b12" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/vitamine-b12/' | relative_url }}" title="Vitamine B12">ğŸ¥©</a></li>
                          {% when "calcium" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/calcium/' | relative_url }}" title="Calcium">ğŸ¦´</a></li>
                          {% when "fer" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/fer/' | relative_url }}" title="Fer">ğŸ§²</a></li>
                          {% when "magnesium" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/magnesium/' | relative_url }}" title="MagnÃ©sium">âš¡</a></li>
                          {% when "potassium" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/potassium/' | relative_url }}" title="Potassium">ğŸŒ</a></li>
                          {% when "zinc" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/zinc/' | relative_url }}" title="Zinc">ğŸ”©</a></li>
                          {% when "selenium" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/selenium/' | relative_url }}" title="SÃ©lÃ©nium">ğŸ§ª</a></li>
                          {% when "iode" %}
                            <li><a class="badge-link-card" href="{{ '/micronutriments/iode/' | relative_url }}" title="Iode">ğŸŒŠ</a></li>
                        {% endcase %}
                      {% endfor %}
                    </ul>
                  {% endif %}
                </div>

              </article>
            </div>

          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>

</section>

