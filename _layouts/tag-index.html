---
layout: page
---

{%- comment -%}
  Page â€œindex filtrÃ©â€ (tags fonctionnels / micronutriments)

  Objectif (UX) :
  - Sur ces pages, le bloc "Random pick" doit apparaÃ®tre AU-DESSUS des 2 lignes de badges cliquables.

  ParamÃ¨tres attendus dans la page :
  - page.filter_type : "tag" ou "micro"
  - page.filter_id   : ID technique (ex: "selenium", "tres-proteine")

  Notes techniques :
  - Le JS du random pick lit document.body.dataset.filterType / filterId.
  - Ici, on renseigne ces attributs le plus tÃ´t possible (sans attendre DOMContentLoaded),
    pour Ã©viter tout effet dâ€™ordre dâ€™exÃ©cution si dâ€™autres scripts changent.

  Ajout : filtre â€œSeulement les recettes testÃ©esâ€
  ----------------------------------------------
  Comportement :
  - Par dÃ©faut : afficher toutes les recettes filtrÃ©es (tag ou micronutriment)
  - Au clic : masquer les recettes non testÃ©es (recipe_tested != true)

  IMPORTANT :
  - Le JS filtre des Ã©lÃ©ments HTML qui doivent exister dans le DOM.
  - Il faut donc que _includes/recipes-index.html enveloppe chaque carte recette avec :
      <div class="recipe-item" data-tested="true|false"> ... </div>
    Sinon, le bouton sâ€™affiche mais ne peut rien masquer.
{%- endcomment -%}

<section class="site-container" id="tag-index">

  {%- comment -%}
    Initialise immÃ©diatement le filtre sur <body> pour que le random pick puisse le lire.
    (Le <body> existe dÃ©jÃ  Ã  ce stade du parsing.)
  {%- endcomment -%}
  <script>
    // Filtre du tirage alÃ©atoire : utilisÃ© par _includes/random-pick.html
    document.body.dataset.filterType = "{{ page.filter_type | escape }}";
    document.body.dataset.filterId = "{{ page.filter_id | escape }}";
  </script>

  {%- comment -%}
    âœ… Random pick sur page badges â€” POSITIONNÃ‰ AVANT la nav des badges
    - hide_links=true : on masque les liens fixes internes du random pick
      (doublon avec la barre nav-badges juste en dessous).
    - Le filtre est appliquÃ© via document.body.dataset.*
  {%- endcomment -%}
  {% include random-pick.html hide_links=true %}

  {%- comment -%}
    Barre de navigation par badges (2 lignes cliquables)
    - Tags fonctionnels
    - Micronutriments
  {%- endcomment -%}
  <div class="nav-badges">

    <!-- Tags fonctionnels -->
    <ul class="recipe-badges-line" aria-label="Tags fonctionnels">
      <li><a class="badge-link" href="{{ '/tags/tres-proteine/' | relative_url }}" title="TrÃ¨s protÃ©inÃ©">ğŸ’ª</a></li>
      <li><a class="badge-link" href="{{ '/tags/riche-en-fibres/' | relative_url }}" title="Riche en fibres">ğŸ’©</a></li>
      <li><a class="badge-link" href="{{ '/tags/rapide/' | relative_url }}" title="Rapide">â±ï¸</a></li>
      <li><a class="badge-link" href="{{ '/tags/congelable/' | relative_url }}" title="CongÃ©lable">â„ï¸</a></li>
      <li><a class="badge-link" href="{{ '/tags/micro-ondable/' | relative_url }}" title="Micro-ondable">â™¨ï¸</a></li>
      <li><a class="badge-link" href="{{ '/tags/peu-calorique/' | relative_url }}" title="Peu calorique">ğŸª¶</a></li>
      <li><a class="badge-link" href="{{ '/tags/calorique/' | relative_url }}" title="Calorique">ğŸ”¥</a></li>
      <li><a class="badge-link" href="{{ '/tags/longue/' | relative_url }}" title="PrÃ©paration longue">ğŸŒ</a></li>
      <li><a class="badge-link" href="{{ '/tags/gout-sucre/' | relative_url }}" title="GoÃ»t sucrÃ©">ğŸ¬</a></li>
    </ul>

    <!-- Micronutriments -->
    <ul class="recipe-badges-line" aria-label="Micronutriments">
      <li><a class="badge-link" href="{{ '/micronutriments/omega-3/' | relative_url }}" title="OmÃ©ga-3">ğŸŸ</a></li>

      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-a/' | relative_url }}" title="Vitamine A">ğŸ‘ï¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-c/' | relative_url }}" title="Vitamine C">ğŸ‹</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-d/' | relative_url }}" title="Vitamine D">ğŸŒ¤ï¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-e/' | relative_url }}" title="Vitamine E">ğŸ›¡ï¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-k/' | relative_url }}" title="Vitamine K">ğŸ©¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-b9/' | relative_url }}" title="Vitamine B9">ğŸŒ±</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-b12/' | relative_url }}" title="Vitamine B12">ğŸ¥©</a></li>

      <li><a class="badge-link" href="{{ '/micronutriments/calcium/' | relative_url }}" title="Calcium">ğŸ¦´</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/fer/' | relative_url }}" title="Fer">ğŸ§²</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/magnesium/' | relative_url }}" title="MagnÃ©sium">âš¡</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/potassium/' | relative_url }}" title="Potassium">ğŸŒ</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/zinc/' | relative_url }}" title="Zinc">ğŸ”©</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/selenium/' | relative_url }}" title="SÃ©lÃ©nium">ğŸ§ª</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/iode/' | relative_url }}" title="Iode">ğŸŒŠ</a></li>
    </ul>
  </div>

  {%- comment -%}
    ===== Bloc descriptif TAG FONCTIONNEL =====
  {%- endcomment -%}
  {%- if page.filter_type == "tag" and page.filter_id -%}
    {%- assign taginfo = site.data.tags_fonctionnels[page.filter_id] -%}
    {%- if taginfo -%}
      <section class="micro-desc">
        <h2>{{ taginfo.titre }}</h2>
        <p>{{ taginfo.signification }}</p>

        {%- if taginfo.criteres -%}
          <h3>CritÃ¨res dâ€™attribution</h3>
          <ul>
            {%- for c in taginfo.criteres -%}<li>{{ c }}</li>{%- endfor -%}
          </ul>
        {%- endif -%}
      </section>
    {%- endif -%}
  {%- endif -%}

  {%- comment -%}
    ===== Bloc descriptif MICRONUTRIMENT =====
  {%- endcomment -%}
  {%- if page.filter_type == "micro" and page.filter_id -%}
    {%- assign micro = site.data.micronutriments[page.filter_id] -%}
    {%- if micro -%}
      <section class="micro-desc">
        <h2>{{ micro.titre }}</h2>
        <p>{{ micro.resume }}</p>

        <h3>Ã€ quoi Ã§a sert ?</h3>
        <ul>{% for r in micro.roles %}<li>{{ r }}</li>{% endfor %}</ul>

        <h3>Quelle dose ?</h3>
        <p><strong>Adulte :</strong> {{ micro.apports.adulte.cible }}</p>

        <h3>OÃ¹ en trouver ?</h3>
        <ul>{% for f in micro.ou_en_trouver %}<li>{{ f }}</li>{% endfor %}</ul>

        <h3>Comment savoir si jâ€™en manque ?</h3>
        <p>{{ micro.carence.signes }}</p>
      </section>
    {%- endif -%}
  {%- endif -%}

  {%- comment -%}
    ===== Liste des recettes filtrÃ©es =====
    - On reconstruit un "grouped" compatible avec _includes/recipes-index.html
    - GitHub Pages (Jekyll 3.10) Ã©tant strict, on Ã©vite where_exp ici.
  {%- endcomment -%}

  {%- assign recipes = site.pages | where: "layout", "recipe" -%}
  {%- assign hidden_tags = "low-carb-modere,low-carb-strict,gout-sucre" | split: "," -%}

  {%- assign filtered = "" | split: "" -%}
  {%- for r in recipes -%}
    {%- if page.filter_type == "tag" and r.tags contains page.filter_id -%}
      {%- assign filtered = filtered | push: r -%}
    {%- elsif page.filter_type == "micro" and r.badges_nutritionnels contains page.filter_id -%}
      {%- assign filtered = filtered | push: r -%}
    {%- endif -%}
  {%- endfor -%}

  {%- comment -%}
    Compte recettes testÃ©es (recipe_tested: true)
    - Utile pour afficher "TestÃ©es : X" + dÃ©cider si le bouton est pertinent.
  {%- endcomment -%}
  {%- assign tested_count = 0 -%}
  {%- for r in filtered -%}
    {%- if r.recipe_tested == true -%}
      {%- assign tested_count = tested_count | plus: 1 -%}
    {%- endif -%}
  {%- endfor -%}

  <p class="small text-muted">
    <strong>{{ filtered.size }}</strong> recette(s).
    <span class="ms-2">TestÃ©e(s) : <strong>{{ tested_count }}</strong>.</span>
  </p>

  {%- comment -%}
    Filtre â€œSeulement les recettes testÃ©esâ€
    - On garde la mÃªme condition dâ€™affichage quâ€™avant.
    - Contenu + JS dÃ©portÃ©s dans _includes/filter-tested.html
    - DÃ©pendance : .recipe-item[data-tested] produit par _includes/recipes-index.html
  {%- endcomment -%}
  {%- if filtered.size > tested_count -%}
    {% include filter-tested.html %}
  {%- endif -%}

  {%- assign grouped_raw = filtered | group_by: "recipe_group" -%}

  {%- comment -%}
    Nettoyage : on exclut les groupes sans nom (nil / vide) sans where_exp
  {%- endcomment -%}
  {%- assign grouped = "" | split: "" -%}
  {%- for g in grouped_raw -%}
    {%- if g.name and g.name != "" -%}
      {%- assign grouped = grouped | push: g -%}
    {%- endif -%}
  {%- endfor -%}

  {%- comment -%}
    âœ… Rendu via lâ€™include existant
  {%- endcomment -%}
  {%- include recipes-index.html grouped=grouped hidden_tags=hidden_tags -%}

</section>

