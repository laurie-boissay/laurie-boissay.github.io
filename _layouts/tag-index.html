---
layout: page
---

{%- comment -%}
  Layout dâ€™index filtrÃ© (compatible GitHub Pages).

  ParamÃ¨tres attendus dans la page :
  - page.filter_type : "tag" ou "micro"
  - page.filter_id   : ID technique (ex: "selenium", "tres-proteine")
{%- endcomment -%}

<section class="site-container" id="tag-index">

  <style>
    /*
      Ajustements locaux (tag-index)
      - On s'appuie sur le style global (.recipe-badges-line) dÃ©fini dans style.css.
      - Ici, on ne garde que la mise en page spÃ©cifique Ã  cette page.
    */

    #tag-index .page-head{ margin-bottom: 1rem; }
    #tag-index .nav-badges{ margin: .75rem 0 1rem 0; }

    /* Bloc descriptif (micro OU tag) */
    #tag-index .micro-desc{
      margin: 1rem 0 1.25rem 0;
      padding: .9rem 1rem;
      border-radius: .75rem;
      background: rgba(0,0,0,.035);
      border: 1px solid rgba(0,0,0,.06);
    }
    #tag-index .micro-desc h2{
      margin: 0 0 .5rem 0;
      font-size: 1.15rem;
      font-weight: 800;
    }
    #tag-index .micro-desc h3{
      margin: .75rem 0 .25rem 0;
      font-size: 1rem;
      font-weight: 800;
    }
    #tag-index .micro-desc ul{
      margin: .25rem 0 .25rem 0;
    }

    /* Grille des recettes filtrÃ©es */
    #tag-index .recipe-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: .65rem;
    }
    @media (min-width: 768px){
      #tag-index .recipe-grid{ grid-template-columns: 1fr 1fr; }
    }

    #tag-index .recipe-card{
      padding: .75rem .85rem;
      border-radius: .6rem;
      background: rgba(0,0,0,.03);
      border: 1px solid rgba(0,0,0,.06);
    }

    #tag-index .recipe-card-title{
      margin: 0 0 .25rem 0;
      font-weight: 800;
      font-size: 1.05rem;
    }
    #tag-index .recipe-card-title a{ text-decoration:none; border-bottom:none; }

    #tag-index .recipe-card-desc{ margin: 0; opacity: .9; }

    /* Liens autour des emojis (badges cliquables dans la nav) */
    #tag-index a.badge-link{
      text-decoration:none;
      border-bottom:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:2rem;
      padding:.15rem .35rem;
      border-radius:.6rem;
      background: rgba(0,0,0,.05);
    }
  </style>

  {%- comment -%}
    Bouton de retour.
    (Tu ne voulais pas de texte â€œFiltreâ€¦â€ et autres, donc on reste minimal.)
  {%- endcomment -%}
  <header class="page-head">
    <a class="btn btn-outline-secondary btn-sm" href="{{ '/' | relative_url }}">
      â† Retour Ã  lâ€™index
    </a>
  </header>

  {%- comment -%}
    NAV â€œbadgesâ€ (comme sous le random pick)
    - Tu as demandÃ© Ã  ne pas afficher de titres ("Tags fonctionnels", "Micronutriments")
  {%- endcomment -%}
  <div class="nav-badges">

    <ul class="recipe-badges-line" aria-label="Tags fonctionnels">
      <li><a class="badge-link" href="{{ '/tags/tres-proteine/' | relative_url }}" title="TrÃ¨s protÃ©inÃ©">ğŸ’ª</a></li>
      <li><a class="badge-link" href="{{ '/tags/riche-en-fibres/' | relative_url }}" title="Riche en fibres">ğŸ’©</a></li>
      <li><a class="badge-link" href="{{ '/tags/rapide/' | relative_url }}" title="Rapide">â±ï¸</a></li>
      <li><a class="badge-link" href="{{ '/tags/congelable/' | relative_url }}" title="CongÃ©lable">â„ï¸</a></li>
      <li><a class="badge-link" href="{{ '/tags/micro-ondable/' | relative_url }}" title="Micro-ondable">â™¨ï¸</a></li>
      <li><a class="badge-link" href="{{ '/tags/peu-calorique/' | relative_url }}" title="Peu calorique">ğŸª¶</a></li>
      <li><a class="badge-link" href="{{ '/tags/calorique/' | relative_url }}" title="Calorique">ğŸ”¥</a></li>
      <li><a class="badge-link" href="{{ '/tags/longue/' | relative_url }}" title="PrÃ©paration longue">ğŸŒ</a></li>
      <li><a class="badge-link" href="{{ '/tags/gout-sucre/' | relative_url }}" title="GoÃ»t sucrÃ©">ğŸ¬</a></li>
    </ul>

    <ul class="recipe-badges-line" aria-label="Micronutriments">
      <li><a class="badge-link" href="{{ '/micronutriments/omega-3/' | relative_url }}" title="OmÃ©ga-3">ğŸŸ</a></li>

      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-a/' | relative_url }}" title="Vitamine A">ğŸ‘ï¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-c/' | relative_url }}" title="Vitamine C">ğŸ‹</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-d/' | relative_url }}" title="Vitamine D">ğŸŒ¤ï¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-e/' | relative_url }}" title="Vitamine E">ğŸ›¡ï¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-k/' | relative_url }}" title="Vitamine K">ğŸ©¸</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-b9/' | relative_url }}" title="Vitamine B9">ğŸŒ±</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/vitamine-b12/' | relative_url }}" title="Vitamine B12">ğŸ¥©</a></li>

      <li><a class="badge-link" href="{{ '/micronutriments/calcium/' | relative_url }}" title="Calcium">ğŸ¦´</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/fer/' | relative_url }}" title="Fer">ğŸ§²</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/magnesium/' | relative_url }}" title="MagnÃ©sium">âš¡</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/potassium/' | relative_url }}" title="Potassium">ğŸŒ</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/zinc/' | relative_url }}" title="Zinc">ğŸ”©</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/selenium/' | relative_url }}" title="SÃ©lÃ©nium">ğŸ§ª</a></li>
      <li><a class="badge-link" href="{{ '/micronutriments/iode/' | relative_url }}" title="Iode">ğŸŒŠ</a></li>
    </ul>
  </div>

  {%- comment -%}
    BLOC DESCRIPTIF TAG FONCTIONNEL
    - S'affiche seulement sur les pages "tag"
    - Le contenu vient de _data/tags_fonctionnels.yml (clÃ© = page.filter_id)
  {%- endcomment -%}
  {%- if page.filter_type == "tag" and page.filter_id -%}
    {%- assign taginfo = site.data.tags_fonctionnels[page.filter_id] -%}
    {%- if taginfo -%}
      <section class="micro-desc" aria-label="Description du tag fonctionnel">

        <h2>{{ taginfo.titre | default: page.title }}</h2>

        {%- if taginfo.signification -%}
          <p>{{ taginfo.signification }}</p>
        {%- endif -%}

        {%- if taginfo.criteres and taginfo.criteres.size > 0 -%}
          <h3>CritÃ¨res dâ€™attribution</h3>
          <ul>
            {%- for item in taginfo.criteres -%}
              <li>{{ item }}</li>
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- if taginfo.notes and taginfo.notes.size > 0 -%}
          <h3>Notes</h3>
          <ul>
            {%- for item in taginfo.notes -%}
              <li>{{ item }}</li>
            {%- endfor -%}
          </ul>
        {%- endif -%}

      </section>
    {%- endif -%}
  {%- endif -%}

  {%- comment -%}
    BLOC DESCRIPTIF MICRONUTRIMENT
    - S'affiche seulement sur les pages "micro"
    - Le contenu vient de _data/micronutriments.yml (clÃ© = page.filter_id)

    Robustesse :
    - dose adulte : accepte micro.apports.adulte.cible_ug_j OU micro.apports.adulte.cible
    - UL          : accepte micro.apports.limite_sup.ul_ug_j OU micro.apports.limite_sup.ul
  {%- endcomment -%}
  {%- if page.filter_type == "micro" and page.filter_id -%}
    {%- assign micro = site.data.micronutriments[page.filter_id] -%}
    {%- if micro -%}

      {%- comment -%} Normalise la â€œdose adulteâ€ si disponible {%- endcomment -%}
      {%- assign adulte_cible = "" -%}
      {%- if micro.apports and micro.apports.adulte -%}
        {%- if micro.apports.adulte.cible_ug_j -%}
          {%- assign adulte_cible = micro.apports.adulte.cible_ug_j -%}
        {%- elsif micro.apports.adulte.cible -%}
          {%- assign adulte_cible = micro.apports.adulte.cible -%}
        {%- endif -%}
      {%- endif -%}

      {%- comment -%} Normalise lâ€™UL si disponible {%- endcomment -%}
      {%- assign ul_val = "" -%}
      {%- if micro.apports and micro.apports.limite_sup -%}
        {%- if micro.apports.limite_sup.ul_ug_j -%}
          {%- assign ul_val = micro.apports.limite_sup.ul_ug_j -%}
        {%- elsif micro.apports.limite_sup.ul -%}
          {%- assign ul_val = micro.apports.limite_sup.ul -%}
        {%- endif -%}
      {%- endif -%}

      <section class="micro-desc" aria-label="Description du micronutriment">

        <h2>{{ micro.titre | default: page.title }}</h2>

        {%- if micro.resume -%}
          <p>{{ micro.resume }}</p>
        {%- endif -%}

        {%- if micro.roles and micro.roles.size > 0 -%}
          <h3>Ã€ quoi Ã§a sert ?</h3>
          <ul>
            {%- for item in micro.roles -%}
              <li>{{ item }}</li>
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- if micro.apports -%}
          {%- if adulte_cible != "" or micro.apports.adulte.sources -%}
            <h3>Quelle dose ?</h3>
            {%- if adulte_cible != "" -%}
              <p>
                <strong>Adulte :</strong> {{ adulte_cible }}.
                {%- if micro.apports.adulte.sources -%}
                  <br>
                  <span class="small text-muted">{{ micro.apports.adulte.sources }}</span>
                {%- endif -%}
              </p>
            {%- else -%}
              {%- comment -%}
                Cas rare : apports prÃ©sents mais pas de â€œcibleâ€ renseignÃ©e.
                On Ã©vite dâ€™afficher â€œAdulte : .â€
              {%- endcomment -%}
              {%- if micro.apports.adulte.sources -%}
                <p class="small text-muted">{{ micro.apports.adulte.sources }}</p>
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}

          {%- if micro.apports.limite_sup and ul_val != "" -%}
            <p class="small text-muted" style="margin-top:.35rem;">
              <strong>Limite supÃ©rieure :</strong> {{ ul_val }}.
              {%- if micro.apports.limite_sup.note -%}
                {{ micro.apports.limite_sup.note }}
              {%- endif -%}
            </p>
          {%- endif -%}
        {%- endif -%}

        {%- if micro.ou_en_trouver and micro.ou_en_trouver.size > 0 -%}
          <h3>OÃ¹ en trouver ?</h3>
          <ul>
            {%- for item in micro.ou_en_trouver -%}
              <li>{{ item }}</li>
            {%- endfor -%}
          </ul>
        {%- endif -%}

        {%- if micro.carence -%}
          <h3>Comment savoir si jâ€™en manque ?</h3>
          {%- if micro.carence.signes -%}
            <p>{{ micro.carence.signes }}</p>
          {%- endif -%}
          {%- if micro.carence.comment_verifier -%}
            <p class="small text-muted">{{ micro.carence.comment_verifier }}</p>
          {%- endif -%}
        {%- endif -%}

        {%- if micro.exces -%}
          <h3>Attention au surdosage</h3>
          {%- if micro.exces.risques -%}
            <p>{{ micro.exces.risques }}</p>
          {%- endif -%}
          {%- if micro.exces.conseil -%}
            <p class="small text-muted">{{ micro.exces.conseil }}</p>
          {%- endif -%}
        {%- endif -%}

      </section>
    {%- endif -%}
  {%- endif -%}

  {%- comment -%}
    RÃ©cupÃ¨re toutes les pages de recettes.
    HypothÃ¨se : tes recettes sont des pages avec layout: recipe.
  {%- endcomment -%}
  {%- assign recipes = site.pages | where: "layout", "recipe" -%}

  {%- comment -%}
    Tags "techniques" Ã  cacher dans l'affichage (comme sur l'index).
  {%- endcomment -%}
  {%- assign hidden_tags = "low-carb-modere,low-carb-strict,gout-sucre" | split: "," -%}

  {%- comment -%}
    Filtrage selon type.
    - si page.filter_type == "tag"  => filtre sur r.tags
    - sinon (micro)                => filtre sur r.badges_nutritionnels
  {%- endcomment -%}
  {%- assign filtered = "" | split: "" -%}
  {%- for r in recipes -%}
    {%- if page.filter_type == "tag" -%}
      {%- if r.tags and r.tags contains page.filter_id -%}
        {%- assign filtered = filtered | push: r -%}
      {%- endif -%}
    {%- else -%}
      {%- if r.badges_nutritionnels and r.badges_nutritionnels contains page.filter_id -%}
        {%- assign filtered = filtered | push: r -%}
      {%- endif -%}
    {%- endif -%}
  {%- endfor -%}

  {%- if filtered.size == 0 -%}
    <p>Aucune recette trouvÃ©e.</p>
  {%- else -%}
    <p class="small text-muted"><strong>{{ filtered.size }}</strong> recette(s).</p>

    <div class="recipe-grid">
      {%- for r in filtered -%}
        <article class="recipe-card">
          <h2 class="recipe-card-title">
            <a href="{{ r.url | relative_url }}">{{ r.recipe_title | default: r.title }}</a>
          </h2>

          {%- if r.description -%}
            <p class="recipe-card-desc">{{ r.description }}</p>
          {%- endif -%}

          <div class="recipe-badges-wrap">

            {%- if r.tags -%}
              <ul class="recipe-badges-line badges-tags" aria-label="Badges">
                {%- for tag in r.tags -%}
                  {%- unless hidden_tags contains tag -%}
                    {%- case tag -%}
                      {%- when "tres-proteine" -%}<li title="TrÃ¨s protÃ©inÃ©">ğŸ’ª</li>
                      {%- when "riche-en-fibres" -%}<li title="Riche en fibres">ğŸ’©</li>
                      {%- when "rapide" -%}<li title="Rapide">â±ï¸</li>
                      {%- when "congelable" -%}<li title="CongÃ©lable">â„ï¸</li>
                      {%- when "micro-ondable" -%}<li title="Micro-ondable">â™¨ï¸</li>
                      {%- when "peu-calorique" -%}<li title="Peu calorique">ğŸª¶</li>
                      {%- when "calorique" -%}<li title="Calorique">ğŸ”¥</li>
                      {%- when "longue" -%}<li title="PrÃ©paration longue">ğŸŒ</li>
                    {%- endcase -%}
                  {%- endunless -%}
                {%- endfor -%}
              </ul>
            {%- endif -%}

            {%- if r.badges_nutritionnels and r.badges_nutritionnels.size > 0 -%}
              <ul class="recipe-badges-line badges-micro" aria-label="Micronutriments">
                {%- for m in r.badges_nutritionnels -%}
                  {%- case m -%}
                    {%- when "omega-3" -%}<li title="OmÃ©ga-3">ğŸŸ</li>

                    {%- when "vitamine-a" -%}<li title="Vitamine A">ğŸ‘ï¸</li>
                    {%- when "vitamine-c" -%}<li title="Vitamine C">ğŸ‹</li>
                    {%- when "vitamine-d" -%}<li title="Vitamine D">ğŸŒ¤ï¸</li>
                    {%- when "vitamine-e" -%}<li title="Vitamine E">ğŸ›¡ï¸</li>
                    {%- when "vitamine-k" -%}<li title="Vitamine K">ğŸ©¸</li>
                    {%- when "vitamine-b9" -%}<li title="Vitamine B9">ğŸŒ±</li>
                    {%- when "vitamine-b12" -%}<li title="Vitamine B12">ğŸ¥©</li>

                    {%- when "calcium" -%}<li title="Calcium">ğŸ¦´</li>
                    {%- when "fer" -%}<li title="Fer">ğŸ§²</li>
                    {%- when "magnesium" -%}<li title="MagnÃ©sium">âš¡</li>
                    {%- when "potassium" -%}<li title="Potassium">ğŸŒ</li>
                    {%- when "zinc" -%}<li title="Zinc">ğŸ”©</li>
                    {%- when "selenium" -%}<li title="SÃ©lÃ©nium">ğŸ§ª</li>
                    {%- when "iode" -%}<li title="Iode">ğŸŒŠ</li>
                  {%- endcase -%}
                {%- endfor -%}
              </ul>
            {%- endif -%}
          </div>
        </article>
      {%- endfor -%}
    </div>
  {%- endif -%}

</section>

