<!DOCTYPE html>
<html lang="fr">
<head>
  {% include head.html %}

  {%- comment -%}
    =========================================================
    LAYOUT â€” RECETTE (STRUCTURANT)
    =========================================================
    RÃ´le :
    - Encadrer lâ€™affichage dâ€™une recette (titre, photo optionnelle, badges,
      bandeau "non testÃ©e", contenu, footer) en sâ€™appuyant sur les includes existants.

    EntrÃ©es (front-matter) :
    - page.title                 : fallback standard.
    - page.recipe_title          : titre affichÃ© sur la page (prioritaire sur page.title).
    - page.tags                  : tags fonctionnels + tags techniques (certains cachÃ©s).
    - page.badges_nutritionnels  : liste de micronutriments (IDs), affichÃ©e en seconde ligne.
    - page.image                 : (optionnel) chemin de lâ€™image de recette.
    - page.image_alt             : (optionnel) texte alternatif (fallback sur recipe_title/title).
    - page.body_id               : (optionnel) identifiant CSS ajoutÃ© Ã  <body>.
    - page.extra_head            : (optionnel) injection contrÃ´lÃ©e de balises dans <head> (ex: JSON-LD).

    DÃ©pendances / includes :
    - head.html                  : head commun (meta, CSS global, etc.).
    - navbar.html                : navigation.
    - bandeau-non-teste.html     : bandeau conditionnel (pilotÃ© par recipe_tested dans le front-matter).
    - footer.html + scripts.html : footer et scripts communs.

    Contrats / contraintes :
    - CSS :
      * aucun style local dans ce layout ; tout passe par style.css pour Ã©viter les divergences.
      * .recipe-badges-line gÃ¨re le wrap + centrage (pas de scroll horizontal).
      * .recipe-photo et .badges-legend sont stylÃ©s globalement.
    - Titres :
      * ce layout rend le <h1> (.recipe-title) ; ne pas inclure dâ€™autre header gÃ©nÃ©rant un <h1>.
    - Tags :
      * certains tags sont "techniques" et doivent rester invisibles cÃ´tÃ© badges.
        Ils restent prÃ©sents pour le filtrage et lâ€™organisation du site.
    =========================================================
  {%- endcomment -%}

  {%- if page.extra_head -%}
    {{ page.extra_head }}
  {%- endif -%}
</head>

<body class="container-fluid recipe{% if page.body_id %} {{ page.body_id }}{% endif %}">
  {%- comment -%}
    PrÃ©vention doublon de titres :
    - recipe-header.html rend dÃ©jÃ  un <h1> dans son implÃ©mentation actuelle.
    - Ce layout rend Ã©galement un <h1> via .recipe-title.
    => On nâ€™inclut pas recipe-header.html ici (sinon hiÃ©rarchie cassÃ©e / doublon SEO).
  {%- endcomment -%}

  {% include navbar.html %}

  <main class="site-main">
    <div class="site-container">

      {% include bandeau-non-teste.html %}

      {%- comment -%}
        Tags techniques / cachÃ©s :
        - Non affichÃ©s dans les badges (UI).
        - ConservÃ©s dans page.tags pour les filtres, index, et lâ€™organisation.
        Remarque :
        - La liste est maintenue ici pour rester cohÃ©rente avec les conventions du site.
      {%- endcomment -%}
      {%- assign hidden_tags = "low-carb-modere,low-carb-strict,gout-sucre" | split: "," -%}

      <header class="recipe-head">
        <h1 class="recipe-title">{{ page.recipe_title | default: page.title }}</h1>

        {%- comment -%}
          Photo optionnelle :
          - ActivÃ©e uniquement si page.image est dÃ©fini.
          - relative_url garantit la compatibilitÃ© avec baseurl (GitHub Pages / environnements).
          - alt :
            * prioritÃ© Ã  page.image_alt
            * fallback sur recipe_title puis title
            * escape pour Ã©viter les surprises en attribut HTML.
        {%- endcomment -%}
        {% if page.image %}
          <figure class="recipe-photo">
            <img
              src="{{ page.image | relative_url }}"
              alt="{{ page.image_alt | default: page.recipe_title | default: page.title | escape }}"
              loading="lazy"
            >
          </figure>
        {% endif %}

        {%- comment -%}
          Badges :
          - Ligne 1 : badges issus des tags fonctionnels (exclure les tags techniques listÃ©s).
          - Ligne 2 : micronutriments (si page.badges_nutritionnels est non vide).
          - Le rendu est volontairement "data-driven" : on mappe un ID -> emoji + title.
          - Le style (wrap + centrage) est gÃ©rÃ© cÃ´tÃ© CSS ; ce layout ne doit pas rÃ©introduire
            de rÃ¨gles de prÃ©sentation.
        {%- endcomment -%}
        <div class="recipe-badges-wrap">

          {%- comment -%}
            Ligne 1 â€” tags fonctionnels :
            - On parcourt page.tags et on ignore hidden_tags.
            - Chaque tag reconnu produit un <li> avec emoji et title.
            - Les tags inconnus sont volontairement silencieux (pas dâ€™affichage parasite).
          {%- endcomment -%}
          {% if page.tags %}
            <ul class="recipe-badges-line badges-tags" aria-label="Badges">
              {% for tag in page.tags %}
                {% unless hidden_tags contains tag %}
                  {% case tag %}
                    {% when "tres-proteine" %}<li title="TrÃ¨s protÃ©inÃ©">ğŸ’ª</li>
                    {% when "riche-en-fibres" %}<li title="Riche en fibres">ğŸ’©</li>
                    {% when "rapide" %}<li title="Rapide">â±ï¸</li>
                    {% when "congelable" %}<li title="CongÃ©lable">â„ï¸</li>
                    {% when "micro-ondable" %}<li title="Micro-ondable">â™¨ï¸</li>
                    {% when "peu-calorique" %}<li title="Peu calorique">ğŸª¶</li>
                    {% when "calorique" %}<li title="Calorique">ğŸ”¥</li>
                    {% when "longue" %}<li title="PrÃ©paration longue">ğŸŒ</li>
                  {% endcase %}
                {% endunless %}
              {% endfor %}
            </ul>
          {% endif %}

          {%- comment -%}
            Ligne 2 â€” micronutriments :
            - Source : page.badges_nutritionnels (liste dâ€™IDs).
            - Condition :
              * on sÃ©curise via default: "" puis test de "size" pour Ã©viter les erreurs.
            - Les IDs non reconnus restent silencieux (pas dâ€™affichage inattendu).
          {%- endcomment -%}
          {% assign micros = page.badges_nutritionnels | default: "" %}
          {% if micros and micros.size > 0 %}
            <ul class="recipe-badges-line badges-micro" aria-label="Micronutriments">
              {% for m in micros %}
                {% case m %}
                  {% when "omega-3" %}<li title="OmÃ©ga-3">ğŸŸ</li>

                  {% when "vitamine-a" %}<li title="Vitamine A">ğŸ‘ï¸</li>
                  {% when "vitamine-c" %}<li title="Vitamine C">ğŸ‹</li>
                  {% when "vitamine-d" %}<li title="Vitamine D">ğŸŒ¤ï¸</li>
                  {% when "vitamine-e" %}<li title="Vitamine E">ğŸ›¡ï¸</li>
                  {% when "vitamine-k" %}<li title="Vitamine K">ğŸ©¸</li>
                  {% when "vitamine-b9" %}<li title="Vitamine B9">ğŸŒ±</li>
                  {% when "vitamine-b12" %}<li title="Vitamine B12">ğŸ¥©</li>

                  {% when "calcium" %}<li title="Calcium">ğŸ¦´</li>
                  {% when "fer" %}<li title="Fer">ğŸ§²</li>
                  {% when "magnesium" %}<li title="MagnÃ©sium">âš¡</li>
                  {% when "potassium" %}<li title="Potassium">ğŸŒ</li>
                  {% when "zinc" %}<li title="Zinc">ğŸ”©</li>
                  {% when "selenium" %}<li title="SÃ©lÃ©nium">ğŸ§ª</li>
                  {% when "iode" %}<li title="Iode">ğŸŒŠ</li>
                {% endcase %}
              {% endfor %}
            </ul>
          {% endif %}

          {%- comment -%}
            LÃ©gende des badges :
            - Fournit une aide explicite sans surcharger lâ€™UI (via <details>).
            - La liste est maintenue cÃ´tÃ© HTML pour rester accessible et indexable.
            - La mise en forme est centralisÃ©e via .badges-legend dans style.css.
          {%- endcomment -%}
          <details class="badges-legend">
            <summary>LÃ©gende des badges</summary>
            <ul>
              <li>ğŸ’ª TrÃ¨s protÃ©inÃ©</li>
              <li>ğŸ’© Riche en fibres</li>
              <li>â±ï¸ Rapide Ã  prÃ©parer</li>
              <li>â„ï¸ CongÃ©lable</li>
              <li>â™¨ï¸ Micro-ondable</li>
              <li>ğŸª¶ Peu calorique</li>
              <li>ğŸ”¥ Calorique</li>
              <li>ğŸŒ PrÃ©paration longue / temps passif important</li>
              <li>ğŸŸ OmÃ©ga-3</li>
              <li>ğŸ‘ï¸ Vitamine A</li>
              <li>ğŸ‹ Vitamine C</li>
              <li>ğŸŒ¤ï¸ Vitamine D</li>
              <li>ğŸ›¡ï¸ Vitamine E</li>
              <li>ğŸ©¸ Vitamine K</li>
              <li>ğŸŒ± Vitamine B9</li>
              <li>ğŸ¥© Vitamine B12</li>
              <li>ğŸ¦´ Calcium</li>
              <li>ğŸ§² Fer</li>
              <li>âš¡ MagnÃ©sium</li>
              <li>ğŸŒ Potassium</li>
              <li>ğŸ”© Zinc</li>
              <li>ğŸ§ª SÃ©lÃ©nium</li>
              <li>ğŸŒŠ Iode</li>
            </ul>
          </details>

        </div>
      </header>

      <div class="content-surface recipe-surface">
        {{ content }}
      </div>

      {% include footer.html %}

    </div>
  </main>

  {% include scripts.html %}
</body>
</html>

